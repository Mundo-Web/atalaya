var k=Object.defineProperty;var O=(o,s,r)=>s in o?k(o,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[s]=r;var f=(o,s,r)=>(O(o,typeof s!="symbol"?s+"":s,r),r);import{m as l,C as D,c as _,R as t,r as c}from"./CreateReactScript-CMiyu2aM.js";import{A as B}from"./Adminto-C54wh4PN.js";import{T as G,M as I,I as p}from"./InputFormGroup-DDan9T05.js";import{R as u,T as g}from"./TippyButton-CV5hF8qb.js";import{T as C}from"./TextareaFormGroup-CkLVDc6p.js";import{P as M}from"./ProjectsRest-94OnTKuH.js";class m{}f(m,"paginate",async s=>{const{result:r}=await l.Fetch("/api/clients/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)});return r}),f(m,"save",async s=>{try{const{status:r,result:n}=await l.Fetch("/api/clients",{method:"POST",body:JSON.stringify(s)});if(!r)throw new Error((n==null?void 0:n.message)||"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return l.Notify.add({icon:"/assets/img/logo.svg",title:"Error",body:r.message,type:"danger"}),!1}}),f(m,"status",async({id:s,status:r})=>{try{const{status:n,result:i}=await l.Fetch("/api/clients/status",{method:"PATCH",body:JSON.stringify({id:s,status:r})});if(!n)throw new Error((i==null?void 0:i.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo.svg",title:"Correcto",body:i.message,type:"success"}),!0}catch(n){return l.Notify.add({icon:"/assets/img/logo.svg",title:"Error",body:n.message,type:"danger"}),!1}}),f(m,"delete",async s=>{try{const{status:r,result:n}=await l.Fetch(`/api/clients/${s}`,{method:"DELETE"});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return l.Notify.add({icon:"/assets/img/logo.svg",title:"Error",body:r.message,type:"danger"}),!1}});const z=()=>{const o=c.useRef(),s=c.useRef(),r=c.useRef(),n=c.useRef(),i=c.useRef(),b=c.useRef(),y=c.useRef(),R=c.useRef(),h=c.useRef(),v=c.useRef(),[x,N]=c.useState(!1),w=e=>{e!=null&&e.id?N(!0):N(!1),r.current.value=(e==null?void 0:e.id)||null,n.current.value=(e==null?void 0:e.ruc)||null,i.current.value=(e==null?void 0:e.name)||null,b.current.value=(e==null?void 0:e.description)||null,y.current.value=(e==null?void 0:e.contact_name)||null,R.current.value=(e==null?void 0:e.contact_phone)||null,h.current.value=(e==null?void 0:e.contact_email)||null,v.current.value=(e==null?void 0:e.contact_address)||null,$(s.current).modal("show")},T=async e=>{e.preventDefault();const a={id:r.current.value||void 0,ruc:n.current.value,name:i.current.value,description:b.current.value,contact_name:y.current.value,contact_phone:R.current.value,contact_email:h.current.value,contact_address:v.current.value};await m.save(a)&&($(o.current).dxDataGrid("instance").refresh(),$(s.current).modal("hide"))},A=async({id:e,status:a})=>{await m.status({id:e,status:a})&&$(o.current).dxDataGrid("instance").refresh()},F=async e=>{await m.delete(e)&&$(o.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(G,{gridRef:o,title:"Clientes",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>w()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",cellTemplate:(e,{data:a,value:E,...d})=>{u(e,t.createElement(g,{className:"btn btn-xs btn-white",title:"Ver proyectos",onClick:()=>{d.component.collapseAll(-1),d.component.expandRow(d.row.data)}},t.createElement("i",{className:"fas fa-shapes"})))}},{dataField:"ruc",caption:"RUC",sortOrder:"asc"},{dataField:"name",caption:"Razon social"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"contact_email",caption:"Correo"},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:a})=>{switch(a.status){case 1:u(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:u(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:u(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:a})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),u(e,t.createElement(g,{className:"btn btn-xs btn-soft-dark",title:"Ver proyectos",onClick:()=>location.href=`/projects/?client=${a.name}`},t.createElement("i",{className:"mdi mdi-page-next"}))),u(e,t.createElement(g,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>w(a)},t.createElement("i",{className:"fa fa-pen"}))),u(e,t.createElement(g,{className:"btn btn-xs btn-light",title:a.status===null?"Restaurar":"Cambiar estado",onClick:()=>A(a)},a.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):a.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),u(e,t.createElement(g,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>F(a.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}],masterDetail:{enabled:!1,template:async(e,{data:a,component:E})=>{e.css("padding","10px");let{data:d}=await M.paginate({filter:["client_id","=",a.id],isLoadingAll:!0});$("<div>").appendTo(e).dxDataGrid({dataSource:d,onToolbarPreparing:S=>{S.toolbarOptions.items.unshift({widget:"dxButton",location:"after",options:{icon:"fa fa-times",hint:"CERRAR TABLA",onClick:j=>{E.collapseAll(-1)}}})},columns:[],allowColumnResizing:!0,columnResizingMode:"widget",columnAutoWidth:!0,showBorders:!0,columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}}})}}}),t.createElement(I,{modalRef:s,title:x?"Editar cliente":"Agregar cliente",onSubmit:T,size:"md"},t.createElement("div",{className:"row"},t.createElement("input",{ref:r,type:"hidden"}),t.createElement(p,{eRef:n,label:"RUC",col:"col-4",required:!0}),t.createElement(p,{eRef:i,label:"Razon social",col:"col-8",required:!0}),t.createElement(C,{eRef:b,label:"Descripcion",col:"col-12"}),t.createElement("div",{className:"col-12"},t.createElement("hr",{className:"my-1"})),t.createElement(p,{eRef:y,label:"Nombre de contacto",col:"col-6"}),t.createElement(p,{eRef:R,label:"Celular de contacto",col:"col-6"}),t.createElement(p,{eRef:h,label:"Email de contacto",col:"col-12",type:"email"}),t.createElement(C,{eRef:v,label:"Direccion de contacto",col:"col-12"}))))};D((o,s)=>{_(o).render(t.createElement(B,{session:s.session,title:"Clientes"},t.createElement(z,{...s})))});
