var j=Object.defineProperty;var C=(e,n,t)=>n in e?j(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var i=(e,n,t)=>(C(e,typeof n!="symbol"?n+"":n,t),t);import{m as o,r as m,R as s}from"./CreateReactScript-BhyNrTql.js";import{M as P}from"./TippyButton-BgjyXFhh.js";import{I as F}from"./InputFormGroup-CvKM2mq1.js";import{i as T}from"./Adminto-CZYR29n7.js";class u{}i(u,"paginate",async n=>{const{result:t}=await o.Fetch("/api/projects/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)});return t}),i(u,"save",async n=>{try{const{status:t,result:r}=await o.Fetch("/api/projects",{method:"POST",body:JSON.stringify(n)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),i(u,"status",async({id:n,status:t})=>{try{const{status:r,result:c}=await o.Fetch("/api/projects/status",{method:"PATCH",body:JSON.stringify({id:n,status:t})});if(!r)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(u,"projectStatus",async(n,t)=>{try{const{status:r,result:c}=await o.Fetch("/api/projects/project-status",{method:"PATCH",body:JSON.stringify({project:n,status:t})});if(!r)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(u,"delete",async n=>{try{const{status:t,result:r}=await o.Fetch(`/api/projects/${n}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});class l{}i(l,"paginate",async n=>{const{result:t}=await o.Fetch("/api/payments/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)});return t}),i(l,"byProject",async n=>{const{result:t}=await o.Fetch(`/api/payments/project/${n}`);return(t==null?void 0:t.data)??[]}),i(l,"save",async n=>{try{const{status:t,result:r}=await o.Fetch("/api/payments",{method:"POST",body:JSON.stringify(n)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),i(l,"status",async({id:n,status:t})=>{try{const{status:r,result:c}=await o.Fetch("/api/payments/status",{method:"PATCH",body:JSON.stringify({id:n,status:t})});if(!r)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(l,"delete",async n=>{try{const{status:t,result:r}=await o.Fetch(`/api/payments/${n}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});const B=({dataLoaded:e,setDataLoaded:n,grid2refresh:t})=>{const r=m.useRef(),c=m.useRef(),g=m.useRef(),y=m.useRef(),[b,p]=m.useState([]);m.useEffect(()=>{e.id&&E(),$(r.current).on("hidden.bs.modal",()=>{n({})})},[e]);const E=async()=>{const a=await l.byProject(e==null?void 0:e.id);p(a),c.current.value=(e==null?void 0:e.id)||null,$(r.current).modal("show")},N=async a=>{a.preventDefault();const w={payment_id:c.current.value||void 0,project_id:e.id,payment_type:g.current.value,amount:y.current.value};if(!await l.save(w))return;g.current.value=null,y.current.value=null;const f=await l.byProject(e.id),h=f.reduce((S,O)=>Number(S)+Number(O.amount),0),v={...e,total_payments:h,remaining_amount:e.cost-h};n(v),p(f),t.refresh()};return s.createElement(P,{modalRef:r,title:`Pagos de ${e==null?void 0:e.name} - S/.${e==null?void 0:e.cost}`,onSubmit:N,hideButtonSubmit:!0},s.createElement("div",{className:`row ${e.remaining_amount>0?"":"d-none"}`},s.createElement("input",{ref:c,type:"hidden"}),s.createElement(F,{eRef:g,label:"Concepto",col:"col-md-7",required:!0}),s.createElement("div",{className:"form-group col-md-5"},s.createElement("label",null,"Monto ",s.createElement("b",{className:"text-danger"},"*")),s.createElement("div",{className:"input-group"},s.createElement("input",{ref:y,type:"number",className:"form-control",placeholder:`Max: ${e==null?void 0:e.remaining_amount}`,min:0,max:e==null?void 0:e.remaining_amount}),s.createElement(T,{content:"Agregar pago"},s.createElement("button",{className:"btn input-group-text btn-dark waves-effect waves-light",type:"submit"},s.createElement("i",{className:"fa fa-plus"})))))),s.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-2"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null),s.createElement("th",null,"Fecha"),s.createElement("th",null,"Concepto"),s.createElement("th",null,"Monto"))),s.createElement("tbody",null,b.map(a=>s.createElement("tr",{key:`project-payment-${a.id}`},s.createElement("td",null),s.createElement("td",null,moment(a.created_at).format("LL")),s.createElement("td",null,a.payment_type),s.createElement("td",null,"S/.",a.amount))))),s.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-0",style:{width:"max-content",float:"right"}},s.createElement("tbody",null,s.createElement("tr",null,s.createElement("th",{colSpan:3,className:"text-end"},"Pagado"),s.createElement("td",null,"S/.",e==null?void 0:e.total_payments)),s.createElement("tr",null,s.createElement("th",{colSpan:3,className:"text-end"},"Por pagar"),s.createElement("td",null,"S/.",e==null?void 0:e.remaining_amount)))))};export{u as P,B as a};
