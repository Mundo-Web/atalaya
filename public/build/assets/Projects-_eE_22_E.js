import{C as Y,c as G,R as t,r as s,m as M}from"./CreateReactScript-BhyNrTql.js";import{T as I,R as o,a as p,M as q,I as c}from"./InputFormGroup-BDWq7Mx9.js";import{P as i,a as B}from"./PaymentModal-DsWHcdgR.js";import{A as V}from"./Adminto-BoRolobJ.js";import{T as O}from"./TextareaFormGroup-DY00xL1h.js";import{S as j,a as C}from"./SetSelectValue-ByIafFDO.js";import{D as L,a as z}from"./DropdownItem-DGbkpcXh.js";const U=({statuses:f,can:l})=>{const a=s.useRef(),d=s.useRef(),b=s.useRef(),E=s.useRef(),y=s.useRef(),g=s.useRef(),R=s.useRef(),v=s.useRef(),h=s.useRef(),x=s.useRef(),N=s.useRef(),[T,w]=s.useState(!1),[A,D]=s.useState({}),F=e=>{var r,n,u,m;e!=null&&e.id?w(!0):w(!1),b.current.value=(e==null?void 0:e.id)||null,C(E.current,(r=e==null?void 0:e.client)==null?void 0:r.id,(n=e==null?void 0:e.client)==null?void 0:n.name),C(y.current,(u=e==null?void 0:e.type)==null?void 0:u.id,(m=e==null?void 0:e.type)==null?void 0:m.name),g.current.value=(e==null?void 0:e.name)||null,R.current.value=(e==null?void 0:e.description)||null,v.current.value=e==null?void 0:e.cost,h.current.value=e!=null&&e.sign_at?moment(e.sign_at).format("YYYY-MM-DD"):null,x.current.value=e!=null&&e.starts_at?moment(e.starts_at).format("YYYY-MM-DD"):null,N.current.value=e!=null&&e.ends_at?moment(e.ends_at).format("YYYY-MM-DD"):null,$(d.current).modal("show")},_=async e=>{e.preventDefault();const r={id:b.current.value||void 0,client_id:E.current.value,type_id:y.current.value,name:g.current.value,description:R.current.value,cost:v.current.value??void 0,sign_at:h.current.value??void 0,starts_at:x.current.value,ends_at:N.current.value};await i.save(r)&&($(a.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"))},S=async({id:e,status:r})=>{await i.status({id:e,status:r})&&$(a.current).dxDataGrid("instance").refresh()},k=async e=>{await i.delete(e)&&$(a.current).dxDataGrid("instance").refresh()},P=async(e,r)=>{await i.projectStatus(e,r)&&$(a.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(I,{gridRef:a,title:"Proyectos",rest:i,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),l("projects","root","all","create")&&e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>F()}})},filterValue:void 0,columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"client.name",caption:"Cliente",filterValue:M.GET.client||void 0},{dataField:"type.name",caption:"Tipo"},{dataField:"name",caption:"Proyecto"},{dataField:"cost",caption:"Costo",dataType:"number",width:150,cellTemplate:(e,{data:r})=>{const n=(r.total_payments/r.cost*100).toFixed(2);o(e,t.createElement(t.Fragment,null,t.createElement("p",{className:"mb-1 d-flex justify-content-between"},t.createElement("span",null,"S/.",Number(r.total_payments).toFixed(2)),t.createElement("b",{className:"float-end"},"S/.",Number(r.cost).toFixed(2))),t.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0"},t.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated animated",role:"progressbar","aria-valuenow":r.total_payments,"aria-valuemin":"0","aria-valuemax":r.cost,style:{width:`${n}%`,visibility:"visible",animationName:"animationProgress"}}))))}},l("projects","root","all","changestatus")&&{dataField:"project_status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),o(e,t.createElement(L,{className:"btn btn-xs btn-white rounded-pill",title:r.project_status.name,tippy:"Actualizar estado",icon:{icon:"fa fa-circle",color:r.project_status.color}},f.map(({id:n,name:u,color:m})=>t.createElement(z,{key:n,onClick:()=>P(r.id,n)},t.createElement("i",{className:"fa fa-circle",style:{color:m}})," ",u))))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:r})=>{switch(r.status){case 1:o(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:o(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:o(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),l("projects","root","all","update")&&o(e,t.createElement(p,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>F(r)},t.createElement("i",{className:"fa fa-pen"}))),l("projects","root","all","addpayments")&&o(e,t.createElement(p,{className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",onClick:()=>D(r)},t.createElement("i",{className:"fas fa-money-check-alt"}))),l("projects","root","all","update")&&o(e,t.createElement(p,{className:"btn btn-xs btn-light",title:r.status===null?"Restaurar":"Cambiar estado",onClick:()=>S(r)},r.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):r.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),l("projects","root","all","delete")&&o(e,t.createElement(p,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>k(r.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(q,{modalRef:d,title:T?"Editar proyecto":"Agregar proyecto",onSubmit:_},t.createElement("div",{className:"row",id:"project-crud-container"},t.createElement("input",{ref:b,type:"hidden"}),t.createElement(j,{eRef:E,label:"Cliente",col:"col-12",dropdownParent:"#project-crud-container",searchAPI:"/api/clients/paginate",searchBy:"name",required:!0}),t.createElement(j,{eRef:y,label:"Tipo del proyecto",col:"col-md-4",dropdownParent:"#project-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",required:!0}),t.createElement(c,{eRef:g,label:"Nombre del proyecto",col:"col-md-8",required:!0}),t.createElement(O,{eRef:R,label:"Descripcion del proyecto",col:"col-12"}),t.createElement(c,{eRef:v,label:"Costo",col:"col-md-6",type:"number",required:!0}),t.createElement(c,{eRef:h,label:"Fecha firma",col:"col-md-6",type:"date"}),t.createElement(c,{eRef:x,label:"Fecha inicio",col:"col-md-6",type:"date",required:!0}),t.createElement(c,{eRef:N,label:"Fecha fin",col:"col-md-6",type:"date",required:!0}))),t.createElement(B,{dataLoaded:A,setDataLoaded:D,grid2refresh:$(a.current).dxDataGrid("instance")}))};Y((f,l)=>{if(!l.can("projects","root","all","list"))return location.href="/";G(f).render(t.createElement(V,{...l,title:"Proyectos"},t.createElement(U,{...l})))});
