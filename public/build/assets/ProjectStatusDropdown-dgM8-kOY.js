var T=Object.defineProperty;var F=(a,e,n)=>e in a?T(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var p=(a,e,n)=>(F(a,typeof e!="symbol"?e+"":e,n),n);import{m as c,r as i,R as t}from"./CreateReactScript-ClVaIZLH.js";import{M as Y,a as j}from"./TippyButton-BGVr4KNJ.js";import{I as P}from"./InputFormGroup-CCmG0Ohr.js";import{i as k}from"./Adminto-WgZqf3ZZ.js";import{P as E,S as A,D as B,a as d}from"./DropdownItem-BbRgo-Zh.js";class y{}p(y,"paginate",async e=>{const{result:n}=await c.Fetch("/api/projects/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return n}),p(y,"save",async e=>{try{const{status:n,result:s}=await c.Fetch("/api/projects",{method:"POST",body:JSON.stringify(e)});if(!n)throw new Error((s==null?void 0:s.message)||"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:s.message,type:"success"}),!0}catch(n){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}}),p(y,"status",async({id:e,status:n})=>{try{const{status:s,result:l}=await c.Fetch("/api/projects/status",{method:"PATCH",body:JSON.stringify({id:e,status:n})});if(!s)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:l.message,type:"success"}),!0}catch(s){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}}),p(y,"projectStatus",async(e,n)=>{try{const{status:s,result:l}=await c.Fetch("/api/projects/project-status",{method:"PATCH",body:JSON.stringify({project:e,status:n})});if(!s)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:l.message,type:"success"}),!0}catch(s){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}}),p(y,"delete",async e=>{try{const{status:n,result:s}=await c.Fetch(`/api/projects/${e}`,{method:"DELETE"});if(!n)throw new Error((s==null?void 0:s.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:s.message,type:"success"}),!0}catch(n){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}});const K=({can:a,dataLoaded:e,setDataLoaded:n,grid2refresh:s})=>{const l=i.useRef(),o=i.useRef(),u=i.useRef(),f=i.useRef(),b=i.useRef(),g=i.useRef(),[C,h]=i.useState([]),[w,N]=i.useState(!1);i.useEffect(()=>{e.id&&_(),$(l.current).on("hidden.bs.modal",()=>{n({}),h([]),N(!1),o.current.value=null,u.current.value=null,f.current.value=null,g.current.value=null})},[e]);const _=async()=>{const r=await E.byProject(e==null?void 0:e.id);h(r),u.current.value=(e==null?void 0:e.id)||null,$(l.current).modal("show")},x=async r=>{r.preventDefault();const m={id:o.current.value||void 0,payment_id:u.current.value,project_id:e.id,payment_type:f.current.value,amount:g.current.value,date:b.current.value};await E.save(m)&&(o.current.value=null,f.current.value=null,g.current.value=null,await S(),s.refresh())},S=async()=>{const r=await E.byProject(e.id),m=r.reduce((M,O)=>Number(M)+Number(O.amount),0),v={...e,total_payments:m,remaining_amount:e.cost-m};n(v),h(r)},R=async r=>{o.current.value=r.id,f.current.value=r.payment_type,g.current.value=r.amount,b.current.value=r.date||moment(r.created_at).format("YYYY-MM-DD"),N(!0)},D=async r=>{const{isConfirmed:m}=await A.fire({title:"Estas seguro de eliminar este pago?",text:"No podras revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!m||!await E.delete(r)||(await S(),s.refresh())};return t.createElement(Y,{modalRef:l,title:`Pagos de ${e==null?void 0:e.name} - S/.${e==null?void 0:e.cost}`,onSubmit:x,hideButtonSubmit:!0},t.createElement("div",{className:`row ${!a("projects","all","addpayment","editpayment")&&"d-none"}`},t.createElement("input",{ref:u,type:"hidden"}),t.createElement("input",{ref:o,type:"hidden"}),t.createElement(P,{eRef:f,label:"Concepto",col:"col-12",required:!0}),t.createElement(P,{eRef:b,type:"date",label:"Fecha",col:"col-md-7",required:!0}),t.createElement("div",{className:"form-group col-md-5"},t.createElement("label",null,"Monto ",t.createElement("b",{className:"text-danger"},"*")),t.createElement("div",{className:"input-group"},t.createElement("input",{ref:g,type:"number",className:"form-control",placeholder:`Max: ${e==null?void 0:e.remaining_amount}`,min:0,max:e==null?void 0:e.remaining_amount}),t.createElement(k,{content:w?"Actualizar pago":"Agregar pago"},t.createElement("button",{className:"btn input-group-text btn-dark waves-effect waves-light",type:"submit"},t.createElement("i",{className:`fa ${w?"fa-save":"fa-plus"}`})))))),t.createElement("hr",{className:"mb-2 mt-0"}),t.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-2"},t.createElement("thead",null,t.createElement("tr",null,a("projects","all","editpayment","deletepayment")&&t.createElement("th",null),t.createElement("th",null,"Concepto"),t.createElement("th",null,"Fecha"),t.createElement("th",null,"Monto"))),t.createElement("tbody",null,C.map(r=>(r.date||(r.date=moment(r.created_at).format("YYYY-MM-DD")),r)).sort((r,m)=>new Date(r.date)-new Date(m.date)).map(r=>t.createElement("tr",{key:`project-payment-${r.id}`},a("projects","all","editpayment","deletepayment")&&t.createElement("td",null,t.createElement("div",{className:"d-flex align-items-center gap-1"},a("projects","all","editpayment")&&t.createElement(j,{title:"Editar pago",className:"btn btn-xs btn-soft-primary",type:"button",onClick:()=>R(r)},t.createElement("i",{className:"fa fa-pen"})),a("projects","all","deletepayment")&&t.createElement(j,{title:"Eliminar pago",className:"btn btn-xs btn-soft-danger",type:"button",onClick:()=>D(r.id)},t.createElement("i",{className:"fa fa-trash"})))),t.createElement("td",null,r.payment_type),t.createElement("td",null,moment(r.date).format("LL")),t.createElement("td",null,"S/.",r.amount))))),t.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-0",style:{width:"max-content",float:"right"}},t.createElement("tbody",null,t.createElement("tr",null,t.createElement("th",{colSpan:3,className:"text-end"},"Pagado"),t.createElement("td",null,"S/.",e==null?void 0:e.total_payments)),t.createElement("tr",null,t.createElement("th",{colSpan:3,className:"text-end"},"Por pagar"),t.createElement("td",null,"S/.",e==null?void 0:e.remaining_amount)))))},Q=({statuses:a,data:e,onChange:n})=>{const s=async(l,o)=>{await y.projectStatus(l,o)&&n()};return t.createElement(t.Fragment,null,t.createElement(B,{className:"btn btn-xs btn-white rounded-pill",title:e.project_status.name,tippy:"Actualizar estado",icon:{icon:"fa fa-circle",color:e.project_status.color}},a.map(({id:l,name:o,color:u})=>t.createElement(d,{key:l,onClick:()=>s(e.id,l)},t.createElement("i",{className:"fa fa-circle",style:{color:u}})," ",o))))};export{y as P,K as a,Q as b};
