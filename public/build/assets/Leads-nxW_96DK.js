import{r as n,R as e,C as M,c as A}from"./CreateReactScript-ClVaIZLH.js";import{T as D,R,M as C,a as v}from"./TippyButton-BGVr4KNJ.js";import{C as y}from"./ClientsRest-CfgxvIc0.js";import{A as I}from"./Adminto-WgZqf3ZZ.js";import{I as f}from"./InputFormGroup-CCmG0Ohr.js";import{T as P}from"./TextareaFormGroup-D05xY0Ci.js";import{P as G,D as O,a as j,S as q}from"./DropdownItem-BbRgo-Zh.js";const V=({can:p,client:t,setClient:o,grid2refresh:h})=>{const r=n.useRef();n.useRef(),n.useRef(),n.useRef(),n.useRef(),n.useRef();const[b,c]=n.useState([]),[E,m]=n.useState(!1);n.useEffect(()=>{t.id&&d(),$(r.current).on("hidden.bs.modal",()=>{o({}),c([]),m(!1)})},[t]);const d=async()=>{const u=await G.byProject(t==null?void 0:t.id);c(u),$(r.current).modal("show")};return e.createElement("div",{ref:r,className:"modal fade",tabIndex:"-1","aria-labelledby":"standard-modalLabel","aria-hidden":"true"},e.createElement("div",{className:"modal-dialog"},e.createElement("div",{className:"modal-content"},e.createElement("div",{className:"modal-header"},e.createElement("h4",{className:"modal-title",id:"standard-modalLabel"},"Notas de  ",(t==null?void 0:t.tradename)||(t==null?void 0:t.name)||(t==null?void 0:t.contact_name)),e.createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})),e.createElement("div",{className:"modal-body"}),e.createElement("div",{className:"modal-footer"},e.createElement("button",{type:"button",className:"btn btn-light","data-bs-dismiss":"modal"},"Close"),e.createElement("button",{type:"button",className:"btn btn-primary"},"Save changes")))))},U=({statuses:p,can:t})=>{const o=n.useRef(),h=n.useRef(),r=n.useRef(),b=n.useRef(),c=n.useRef(),E=n.useRef(),m=n.useRef(),d=n.useRef(),u=n.useRef(),[N,_]=n.useState(!1),[s,x]=n.useState({}),[T,g]=n.useState({}),S=a=>{_(!1),b.current.value="",c.current.value="",E.current.value="",m.current.value="",d.current.value="",u.current.value="",$(r.current).modal("show")},F=async a=>{a.preventDefault();const l={contact_name:b.current.value,contact_email:c.current.value,contact_phone:E.current.value,name:m.current.value,web_url:d.current.value,message:u.current.value,client_width:window.screen.width,client_height:window.screen.height,client_system:navigator.platform??"Linux"};await y.save(l)&&($(o.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"))},L=a=>{x(a),$(h.current).modal("show")},w=async(a,l)=>{await y.clientStatus(a,l)&&$(o.current).dxDataGrid("instance").refresh()};return e.createElement(e.Fragment,null,e.createElement(D,{gridRef:o,title:"Leads",rest:y,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),t("leads","root","all","create")&&a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>S()}})},filterValue:["client_status.id","<>",12],columns:[{dataField:"contact_name",caption:"Cliente"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"client_status.id",caption:"ID estado cliente",visible:!1},t("leads","root","all","changestatus")?{dataField:"client_status.name",caption:"Estado del cliente",dataType:"string",cellTemplate:(a,{data:l})=>{a.attr("style","overflow: visible"),R(a,e.createElement(O,{className:"btn btn-xs btn-white rounded-pill",title:l.client_status.name,icon:{icon:"fa fa-circle",color:l.client_status.color},tippy:"Actualizar estado"},p.map(({id:i,name:B,color:k})=>e.createElement(j,{key:i,onClick:()=>w(l.id,i)},e.createElement("i",{className:"fa fa-circle",style:{color:k}})," ",B))))}}:null,{dataField:"source",caption:"Fuente",dataType:"string"},{dataField:"created_at",caption:"Fecha creacion",dataType:"datetime",cellTemplate:(a,{data:l})=>{a.text(moment(l.created_at).format("lll"))},sortOrder:"desc"},{caption:"Acciones",cellTemplate:(a,{data:l})=>{a.attr("style","display: flex; gap: 4px; overflow: visible"),t("leads","root","all","movetoclient")&&R(a,e.createElement(v,{className:"btn btn-xs btn-soft-success",title:"Convertir en cliente",onClick:async()=>{const{isConfirmed:i}=await q.fire({title:"Estas seguro?",text:`${l.contact_name} pasara a ser un cliente!`,icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});i&&w(l.id,12)}},e.createElement("i",{className:"fa fa-user-plus"}))),t("leads","root","all","addnotes")&&R(a,e.createElement(v,{className:"btn btn-xs btn-soft-primary",title:"Ver/Agregar notas",onClick:()=>g(l)},e.createElement("i",{className:"fas fa-sticky-note"}))),R(a,e.createElement(v,{className:"btn btn-xs btn-soft-info",title:"Ver lead",onClick:()=>L(l)},e.createElement("i",{className:"fa fa-comment"})))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(C,{modalRef:h,title:`Lead de ${s==null?void 0:s.contact_name}`,onSubmit:a=>{a.preventDefault(),$(r.current).modal("hide")},hideButtonSubmit:!0},e.createElement("div",null,e.createElement("p",null,e.createElement("b",null,"Telefono"),": ",s==null?void 0:s.contact_phone),e.createElement("p",{className:"my-2"},e.createElement("b",null,"Correo"),": ",s==null?void 0:s.contact_email),e.createElement("b",null,"Mensaje"),":",e.createElement("p",{className:"mb-0"},s==null?void 0:s.message))),e.createElement(C,{modalRef:r,title:N?"Editar lead":"Nuevo lead",btnSubmitText:"Guardar",onSubmit:F},e.createElement("div",{className:"row mb-0"},e.createElement(f,{eRef:b,label:"Nombre completo",required:!0}),e.createElement(f,{eRef:c,label:"Correo electronico",col:"col-md-6",required:!0}),e.createElement(f,{eRef:E,label:"Telefono",col:"col-md-6",required:!0}),e.createElement(f,{eRef:m,label:"Empresa / Marca",col:"col-md-6"}),e.createElement(f,{eRef:d,label:"Link de WEB",col:"col-md-6"}),e.createElement(P,{eRef:u,label:"Mensaje",placeholder:"Ingresa tu mensaje",rows:4,required:!0}))),e.createElement(V,{can:t,client:T,setClient:g,grid2refresh:o}))};M((p,t)=>{if(!t.can("leads","root","all","list"))return location.href="/";A(p).render(e.createElement(I,{...t,title:"Leads"},e.createElement(U,{...t})))});
