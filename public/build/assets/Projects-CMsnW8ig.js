import{C as P,c as Y,R as t,r as n,m as G}from"./CreateReactScript-CMiyu2aM.js";import{T as I,R as c,a as h,M}from"./TippyButton-DUaps99m.js";import{P as o}from"./ProjectsRest-94OnTKuH.js";import{A as j}from"./Adminto-6gONrFtF.js";import{I as i}from"./InputFormGroup-orumVN07.js";import{T as q}from"./TextareaFormGroup-CkLVDc6p.js";import{S as T,a as A}from"./SetSelectValue-CLjGB2wR.js";import{D as B,a as O,m as x}from"./DropdownItem-CXiJPpAc.js";const V=({statuses:u})=>{const s=n.useRef(),m=n.useRef(),p=n.useRef(),f=n.useRef(),d=n.useRef(),E=n.useRef(),R=n.useRef(),b=n.useRef(),y=n.useRef(),g=n.useRef(),v=n.useRef(),[F,w]=n.useState(!1),D=e=>{var r,l,a,C;e!=null&&e.id?w(!0):w(!1),p.current.value=(e==null?void 0:e.id)||null,A(f.current,(r=e==null?void 0:e.client)==null?void 0:r.id,(l=e==null?void 0:e.client)==null?void 0:l.name),A(d.current,(a=e==null?void 0:e.type)==null?void 0:a.id,(C=e==null?void 0:e.type)==null?void 0:C.name),E.current.value=(e==null?void 0:e.name)||null,R.current.value=(e==null?void 0:e.description)||null,b.current.value=e==null?void 0:e.cost,y.current.value=e!=null&&e.sign_at?x(e.sign_at).format("YYYY-MM-DD"):null,g.current.value=e!=null&&e.starts_at?x(e.starts_at).format("YYYY-MM-DD"):null,v.current.value=e!=null&&e.ends_at?x(e.ends_at).format("YYYY-MM-DD"):null,$(m.current).modal("show")},N=async e=>{e.preventDefault();const r={id:p.current.value||void 0,client_id:f.current.value,type_id:d.current.value,name:E.current.value,description:R.current.value,cost:b.current.value??void 0,sign_at:y.current.value??void 0,starts_at:g.current.value,ends_at:v.current.value};await o.save(r)&&($(s.current).dxDataGrid("instance").refresh(),$(m.current).modal("hide"))},k=async({id:e,status:r})=>{await o.status({id:e,status:r})&&$(s.current).dxDataGrid("instance").refresh()},S=async e=>{await o.delete(e)&&$(s.current).dxDataGrid("instance").refresh()},_=async(e,r)=>{await o.projectStatus(e,r)&&$(s.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(I,{gridRef:s,title:"Proyectos",rest:o,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>D()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"client.name",caption:"Cliente",filterValue:G.GET.client||void 0},{dataField:"type.name",caption:"Tipo"},{dataField:"name",caption:"Proyecto"},{dataField:"cost",caption:"Costo",dataType:"number"},{dataField:"project_status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),c(e,t.createElement(B,{className:"btn btn-xs btn-white rounded-pill",title:r.project_status.name,tippy:"Actualizar estado"},u.map(({id:l,name:a})=>t.createElement(O,{key:l,onClick:()=>_(r.id,l)},a))))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:r})=>{switch(r.status){case 1:c(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:c(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:c(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),c(e,t.createElement(h,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>D(r)},t.createElement("i",{className:"fa fa-pen"}))),c(e,t.createElement(h,{className:"btn btn-xs btn-light",title:r.status===null?"Restaurar":"Cambiar estado",onClick:()=>k(r)},r.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):r.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),c(e,t.createElement(h,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(r.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(M,{modalRef:m,title:F?"Editar proyecto":"Agregar proyecto",onSubmit:N},t.createElement("div",{className:"row",id:"project-crud-container"},t.createElement("input",{ref:p,type:"hidden"}),t.createElement(T,{eRef:f,label:"Cliente",col:"col-12",dropdownParent:"#project-crud-container",searchAPI:"/api/clients/paginate",searchBy:"name",required:!0}),t.createElement(T,{eRef:d,label:"Tipo del proyecto",col:"col-md-4",dropdownParent:"#project-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",required:!0}),t.createElement(i,{eRef:E,label:"Nombre del proyecto",col:"col-md-8",required:!0}),t.createElement(q,{eRef:R,label:"Descripcion del proyecto",col:"col-12"}),t.createElement(i,{eRef:b,label:"Costo",col:"col-md-6",type:"number",required:!0}),t.createElement(i,{eRef:y,label:"Fecha firma",col:"col-md-6",type:"date"}),t.createElement(i,{eRef:g,label:"Fecha inicio",col:"col-md-6",type:"date",required:!0}),t.createElement(i,{eRef:v,label:"Fecha fin",col:"col-md-6",type:"date",required:!0}))))};P((u,s)=>{Y(u).render(t.createElement(j,{session:s.session,title:"Proyectos"},t.createElement(V,{...s})))});
