var O=Object.defineProperty;var k=(o,r,s)=>r in o?O(o,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[r]=s;var d=(o,r,s)=>(k(o,typeof r!="symbol"?r+"":r,s),s);import{m as l,C as P,c as D,R as t,r as i}from"./CreateReactScript-BZNFBiYC.js";import{A as G}from"./Adminto-OuUk_WSc.js";import{T as I,R as m,a as v,M as q}from"./TippyButton-BjIlaKQi.js";import{I as w}from"./InputFormGroup-BUOjBXeO.js";import{P as S}from"./PasswordFormGroup-zFVO4Fqi.js";import{J as B}from"./JSEncrypt-D3I3x59l.js";import{a as J,S as M}from"./SetSelectValue-TcZeamg_.js";import{R as j}from"./RolesRest-BIP0dnCB.js";class u{}d(u,"paginate",async r=>{const{result:s}=await l.Fetch("/api/users/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)});return s}),d(u,"save",async r=>{try{const{status:s,result:n}=await l.Fetch("/api/users",{method:"POST",body:JSON.stringify(r)});if(!s)throw new Error((n==null?void 0:n.message)||"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(s){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}}),d(u,"status",async({id:r,status:s})=>{try{const{status:n,result:c}=await l.Fetch("/api/users/status",{method:"PATCH",body:JSON.stringify({id:r,status:s})});if(!n)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(n){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}}),d(u,"delete",async r=>{try{const{status:s,result:n}=await l.Fetch(`/api/users/${r}`,{method:"DELETE"});if(!s)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(s){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}});const L=({PUBLIC_RSA_KEY:o})=>{const r=i.useRef(),s=i.useRef(),n=i.useRef(),c=i.useRef(),f=i.useRef(),p=i.useRef(),g=i.useRef(),y=i.useRef(),E=i.useRef(),b=new B;b.setPublicKey(o);const[h,N]=i.useState(!1),C=async e=>{e!=null&&e.id?N(!0):N(!1);const a=await j.byUser(e==null?void 0:e.id);n.current.value=(e==null?void 0:e.id)||null,c.current.value=(e==null?void 0:e.name)||null,f.current.value=(e==null?void 0:e.lastname)||null,p.current.value=(e==null?void 0:e.email)||null,M(g.current,a,"id","name"),y.current.value=null,E.current.value=null,$(s.current).modal("show")},x=async e=>{e.preventDefault();const a=y.current.value,R=E.current.value,T={id:n.current.value||void 0,name:c.current.value,lastname:f.current.value,email:p.current.value,roles:$(g.current).val(),password:a?b.encrypt(a):void 0,confirm:R?b.encrypt(R):void 0};await u.save(T)&&($(r.current).dxDataGrid("instance").refresh(),$(s.current).modal("hide"))},A=async({id:e,status:a})=>{await u.status({id:e,status:a})&&$(r.current).dxDataGrid("instance").refresh()},F=async e=>{await u.delete(e)&&$(r.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(I,{gridRef:r,title:"Usuarios",rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>C()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"email",caption:"Correo",dataType:"email",cellTemplate:(e,{data:a})=>{m(e,t.createElement(t.Fragment,null,t.createElement("img",{className:"avatar-xs rounded-circle me-1",src:`/api/profile/thumbnail/${a.relative_id}`,alt:a.name}),a.email))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:a})=>{switch(a.status){case 1:m(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:m(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:m(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:a})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),m(e,t.createElement(v,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>C(a)},t.createElement("i",{className:"fa fa-pen"}))),m(e,t.createElement(v,{className:"btn btn-xs btn-light",title:a.status===null?"Restaurar":"Cambiar estado",onClick:()=>A(a)},a.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):a.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),m(e,t.createElement(v,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>F(a.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(q,{modalRef:s,title:h?"Editar usuario":"Agregar usuario",onSubmit:x},t.createElement("div",{className:"row",id:"users-crud-container"},t.createElement("input",{ref:n,type:"hidden"}),t.createElement(w,{eRef:c,label:"Nombres",col:"col-md-6",required:!0}),t.createElement(w,{eRef:f,label:"Apellidos",col:"col-md-6",required:!0}),t.createElement(w,{eRef:p,label:"Correo",col:"col-12",type:"email",required:!0}),t.createElement(J,{eRef:g,label:"Asignar roles",col:"col-12",dropdownParent:"#users-crud-container",searchAPI:"/api/roles/paginate",searchBy:"name",required:!0,multiple:!0}),t.createElement(S,{eRef:y,label:"Contraseña",col:"col-md-6",required:!h}),t.createElement(S,{eRef:E,label:"Repetir contraseña",col:"col-md-6",required:!h}))))};P((o,r)=>{D(o).render(t.createElement(G,{...r,title:"Usuarios"},t.createElement(L,{...r})))});
