var A=Object.defineProperty;var R=(c,e,r)=>e in c?A(c,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[e]=r;var l=(c,e,r)=>(R(c,typeof e!="symbol"?e+"":e,r),r);import{m as o,r as i,R as t}from"./CreateReactScript-ClVaIZLH.js";import{M as Y,a as C}from"./TippyButton-8JVuESJr.js";import{I as O}from"./InputFormGroup-CCmG0Ohr.js";import{i as k}from"./Adminto-BSg1Iqw4.js";import{S as B,D as J}from"./Dropdown-CVEN-Z_y.js";import{D as I}from"./DropdownItem-CGQ01ebz.js";class g{}l(g,"paginate",async e=>{const{result:r}=await o.Fetch("/api/projects/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return r}),l(g,"save",async e=>{try{const{status:r,result:n}=await o.Fetch("/api/projects",{method:"POST",body:JSON.stringify(e)});if(!r)throw new Error((n==null?void 0:n.message)||"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),l(g,"status",async({id:e,status:r})=>{try{const{status:n,result:a}=await o.Fetch("/api/projects/status",{method:"PATCH",body:JSON.stringify({id:e,status:r})});if(!n)throw new Error((a==null?void 0:a.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(n){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}}),l(g,"projectStatus",async(e,r)=>{try{const{status:n,result:a}=await o.Fetch("/api/projects/project-status",{method:"PATCH",body:JSON.stringify({project:e,status:r})});if(!n)throw new Error((a==null?void 0:a.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(n){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}}),l(g,"delete",async e=>{try{const{status:r,result:n}=await o.Fetch(`/api/projects/${e}`,{method:"DELETE"});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}});class u{}l(u,"paginate",async e=>{const{result:r}=await o.Fetch("/api/payments/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return r}),l(u,"byProject",async e=>{const{result:r}=await o.Fetch(`/api/payments/project/${e}`);return(r==null?void 0:r.data)??[]}),l(u,"save",async e=>{try{const{status:r,result:n}=await o.Fetch("/api/payments",{method:"POST",body:JSON.stringify(e)});if(!r)throw new Error((n==null?void 0:n.message)||"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),l(u,"status",async({id:e,status:r})=>{try{const{status:n,result:a}=await o.Fetch("/api/payments/status",{method:"PATCH",body:JSON.stringify({id:e,status:r})});if(!n)throw new Error((a==null?void 0:a.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(n){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}}),l(u,"delete",async e=>{try{const{status:r,result:n}=await o.Fetch(`/api/payments/${e}`,{method:"DELETE"});if(!r)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(r){return o.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}});const V=({can:c,dataLoaded:e,setDataLoaded:r,grid2refresh:n})=>{const a=i.useRef(),m=i.useRef(),y=i.useRef(),f=i.useRef(),E=i.useRef(),b=i.useRef(),[P,h]=i.useState([]),[N,v]=i.useState(!1),[S,j]=i.useState(Number(e==null?void 0:e.remaining_amount));i.useEffect(()=>{e.id&&x(),$(a.current).on("hidden.bs.modal",()=>{r({}),h([]),v(!1),m.current.value=null,y.current.value=null,f.current.value=null,b.current.value=null})},[e]);const x=async()=>{const s=await u.byProject(e==null?void 0:e.id);h(s),j(Number(e==null?void 0:e.remaining_amount)),y.current.value=(e==null?void 0:e.id)||null,$(a.current).modal("show")},_=async s=>{s.preventDefault();const p={id:m.current.value||void 0,payment_id:y.current.value,project_id:e.id,payment_type:f.current.value,amount:b.current.value,date:E.current.value};await u.save(p)&&(m.current.value=null,f.current.value=null,b.current.value=null,await d(),n.refresh())},d=async()=>{const s=await u.byProject(e.id),p=s.reduce((F,M)=>Number(F)+Number(M.amount),0),w={...e,total_payments:p,remaining_amount:e.cost-p};r(w),h(s)},D=async s=>{m.current.value=s.id,f.current.value=s.payment_type,b.current.value=s.amount,E.current.value=s.date||moment(s.created_at).format("YYYY-MM-DD"),j(Number(e==null?void 0:e.remaining_amount)+Number(s.amount)),v(!0)},T=async s=>{const{isConfirmed:p}=await B.fire({title:"Estas seguro de eliminar este pago?",text:"No podras revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!p||!await u.delete(s)||(await d(),n.refresh())};return t.createElement(Y,{modalRef:a,title:`Pagos de ${e==null?void 0:e.name} - S/.${e==null?void 0:e.cost}`,onSubmit:_,hideButtonSubmit:!0},t.createElement("div",{className:`row ${!c("projects","all","addpayment","editpayment")&&"d-none"}`},t.createElement("input",{ref:y,type:"hidden"}),t.createElement("input",{ref:m,type:"hidden"}),t.createElement(O,{eRef:f,label:"Concepto",col:"col-12",required:!0}),t.createElement(O,{eRef:E,type:"date",label:"Fecha",col:"col-md-7",required:!0}),t.createElement("div",{className:"form-group col-md-5"},t.createElement("label",null,"Monto ",t.createElement("b",{className:"text-danger"},"*")),t.createElement("div",{className:"input-group"},t.createElement("input",{ref:b,type:"number",className:"form-control",placeholder:`Max: ${S}`,min:0,max:S,step:.01}),t.createElement(k,{content:N?"Actualizar pago":"Agregar pago"},t.createElement("button",{className:"btn input-group-text btn-dark waves-effect waves-light",type:"submit"},t.createElement("i",{className:`fa ${N?"fa-save":"fa-plus"}`})))))),t.createElement("hr",{className:"mb-2 mt-0"}),t.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-2"},t.createElement("thead",null,t.createElement("tr",null,c("projects","all","editpayment","deletepayment")&&t.createElement("th",null),t.createElement("th",null,"Concepto"),t.createElement("th",null,"Fecha"),t.createElement("th",null,"Monto"))),t.createElement("tbody",null,P.map(s=>(s.date||(s.date=moment(s.created_at).format("YYYY-MM-DD")),s)).sort((s,p)=>new Date(s.date)-new Date(p.date)).map(s=>t.createElement("tr",{key:`project-payment-${s.id}`},c("projects","all","editpayment","deletepayment")&&t.createElement("td",null,t.createElement("div",{className:"d-flex align-items-center gap-1"},c("projects","all","editpayment")&&t.createElement(C,{title:"Editar pago",className:"btn btn-xs btn-soft-primary",type:"button",onClick:()=>D(s)},t.createElement("i",{className:"fa fa-pen"})),c("projects","all","deletepayment")&&t.createElement(C,{title:"Eliminar pago",className:"btn btn-xs btn-soft-danger",type:"button",onClick:()=>T(s.id)},t.createElement("i",{className:"fa fa-trash"})))),t.createElement("td",null,s.payment_type),t.createElement("td",null,moment(s.date).format("LL")),t.createElement("td",null,"S/.",s.amount))))),t.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-0",style:{width:"max-content",float:"right"}},t.createElement("tbody",null,t.createElement("tr",null,t.createElement("th",{colSpan:3,className:"text-end"},"Pagado"),t.createElement("td",null,"S/.",e==null?void 0:e.total_payments)),t.createElement("tr",null,t.createElement("th",{colSpan:3,className:"text-end"},"Por pagar"),t.createElement("td",null,"S/.",e==null?void 0:e.remaining_amount)))))},W=({statuses:c,data:e,onChange:r})=>{const n=async(a,m)=>{await g.projectStatus(a,m)&&r()};return t.createElement(t.Fragment,null,t.createElement(J,{className:"btn btn-xs btn-white rounded-pill",title:e.project_status.name,tippy:"Actualizar estado",icon:{icon:"fa fa-circle",color:e.project_status.color}},c.map(({id:a,name:m,color:y})=>t.createElement(I,{key:a,onClick:()=>n(e.id,a)},t.createElement("i",{className:"fa fa-circle",style:{color:y}})," ",m))))};export{g as P,V as a,W as b};
