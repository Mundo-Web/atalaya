import{C as A,c as M,R as t,r as l}from"./CreateReactScript-ClVaIZLH.js";import{T as G,R as c,a as u,M as N}from"./TippyButton-BjF7-mNh.js";import{C as g,a as I}from"./ClientNotesModal-BkcKw4Xr.js";import{A as O}from"./Adminto-Cj0zDMIz.js";import{I as i}from"./InputFormGroup-Bbi-6ZmO.js";import{T as q}from"./TextareaFormGroup-D05xY0Ci.js";import{D as V,S as j}from"./Dropdown-B-S9O-LC.js";import{D as U}from"./DropdownItem-CGQ01ebz.js";import"./SetSelectValue-CwDYwahQ.js";import"./DropdownEnd-TZDw8Qnf.js";const z=({statuses:f,can:a})=>{const s=l.useRef(),w=l.useRef(),m=l.useRef(),p=l.useRef(),d=l.useRef(),E=l.useRef(),b=l.useRef(),R=l.useRef(),h=l.useRef(),v=l.useRef(),[T,C]=l.useState(!1),[r,S]=l.useState({}),[F,_]=l.useState({}),x=e=>{e!=null&&e.id?C(!0):C(!1),p.current.value=(e==null?void 0:e.id)??"",d.current.value=(e==null?void 0:e.contact_name)??"",E.current.value=(e==null?void 0:e.contact_email)??"",b.current.value=(e==null?void 0:e.contact_phone)??"",R.current.value=(e==null?void 0:e.name)??"",h.current.value=(e==null?void 0:e.web_url)??"",v.current.value=(e==null?void 0:e.message)??"",$(m.current).modal("show")},L=async e=>{e.preventDefault();const n={id:p.current.value,contact_name:d.current.value,contact_email:E.current.value,contact_phone:b.current.value,name:R.current.value,web_url:h.current.value,message:v.current.value,client_width:window.screen.width,client_height:window.screen.height,client_system:navigator.platform??"Linux"};await g.save(n)&&($(s.current).dxDataGrid("instance").refresh(),$(m.current).modal("hide"))},k=e=>{S(e),$(w.current).modal("show")},y=async(e,n)=>{await g.clientStatus(e,n)&&$(s.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(G,{gridRef:s,title:"Leads",rest:g,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),a("leads","root","all","create")&&e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>x()}})},filterValue:["client_status.id","<>",12],columns:[{dataField:"contact_name",caption:"Cliente"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"client_status.id",caption:"ID estado cliente",visible:!1},a("leads","root","all","changestatus")?{dataField:"client_status.name",caption:"Estado del cliente",dataType:"string",cellTemplate:(e,{data:n})=>{e.attr("style","overflow: visible"),c(e,t.createElement(V,{className:"btn btn-xs btn-white rounded-pill",title:n.client_status.name,icon:{icon:"fa fa-circle",color:n.client_status.color},tippy:"Actualizar estado"},f.map(({id:o,name:B,color:D})=>t.createElement(U,{key:o,onClick:()=>y(n.id,o)},t.createElement("i",{className:"fa fa-circle",style:{color:D}})," ",B))))}}:null,{dataField:"source",caption:"Fuente",dataType:"string"},{dataField:"created_at",caption:"Fecha creacion",dataType:"datetime",cellTemplate:(e,{data:n})=>{e.text(moment(n.created_at).format("lll"))},sortOrder:"desc"},{caption:"Acciones",cellTemplate:(e,{data:n})=>{e.attr("style","display: flex; gap: 4px; overflow: visible"),a("leads","root","all","update")&&c(e,t.createElement(u,{className:"btn btn-xs btn-soft-primary",title:"Editar lead",onClick:()=>x(n)},t.createElement("i",{className:"fa fa-pen"}))),a("leads","root","all","movetoclient")&&c(e,t.createElement(u,{className:"btn btn-xs btn-soft-success",title:"Convertir en cliente",onClick:async()=>{const{isConfirmed:o}=await j.fire({title:"Estas seguro?",text:`${n.contact_name} pasara a ser un cliente!`,icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});o&&y(n.id,12)}},t.createElement("i",{className:"fa fa-user-plus"}))),a("leads","root","all","addnotes")&&c(e,t.createElement(u,{className:"btn btn-xs btn-soft-primary position-relative",title:"Ver/Agregar notas",onClick:()=>_(n)},t.createElement("i",{className:"fas fa-sticky-note"}),n.notes>0&&t.createElement("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"},n.notes,t.createElement("span",{className:"visually-hidden"},"Notas de ",n.name)))),c(e,t.createElement(u,{className:"btn btn-xs btn-soft-info",title:"Ver lead",onClick:()=>k(n)},t.createElement("i",{className:"fa fa-comment"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(N,{modalRef:w,title:`Lead de ${r==null?void 0:r.contact_name}`,onSubmit:e=>{e.preventDefault(),$(m.current).modal("hide")},hideButtonSubmit:!0},t.createElement("div",null,t.createElement("p",null,t.createElement("b",null,"Telefono"),": ",r==null?void 0:r.contact_phone),t.createElement("p",{className:"my-2"},t.createElement("b",null,"Correo"),": ",r==null?void 0:r.contact_email),t.createElement("b",null,"Mensaje"),":",t.createElement("p",{className:"mb-0"},r==null?void 0:r.message))),t.createElement(N,{modalRef:m,title:T?"Editar lead":"Nuevo lead",btnSubmitText:"Guardar",onSubmit:L},t.createElement("div",{className:"row mb-0"},t.createElement("input",{ref:p,type:"hidden"}),t.createElement(i,{eRef:d,label:"Nombre completo",required:!0}),t.createElement(i,{eRef:E,label:"Correo electronico",type:"email",col:"col-md-6"}),t.createElement(i,{eRef:b,label:"Telefono",col:"col-md-6",required:!0}),t.createElement(i,{eRef:R,label:"Empresa / Marca",col:"col-md-6"}),t.createElement(i,{eRef:h,label:"Link de WEB",col:"col-md-6"}),t.createElement(q,{eRef:v,label:"Mensaje",placeholder:"Ingresa tu mensaje",rows:4,required:!0}))),t.createElement(I,{can:a,client:F,setClient:_,grid2refresh:s,page:"leads"}))};A((f,a)=>{if(!a.can("leads","root","all","list"))return location.href="/";M(f).render(t.createElement(O,{...a,title:"Leads"},t.createElement(z,{...a})))});
