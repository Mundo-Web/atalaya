import{R as t,C as D,c as S,r as n}from"./CreateReactScript-ClVaIZLH.js";import{i as G,A as P}from"./Adminto-WgZqf3ZZ.js";import{T as M,R as d,M as k,a as b}from"./TippyButton-A6Ff804B.js";import{I as B}from"./InputFormGroup-CCmG0Ohr.js";import{R as x}from"./RolesRest-BoZVqJ8A.js";import{T as O}from"./TextareaFormGroup-D05xY0Ci.js";import{P as v}from"./PermissionsRest-HHNk85Gt.js";import{A as I,a as L}from"./AccordionCard-iq8izzZ-.js";const _=({title:o,label:s,id:i,name:l,value:c,checked:m,required:u,rounded:p=!1,style:h,className:f})=>t.createElement(G,{content:o,arrow:!0},t.createElement("div",{className:`form-check form-check-success ${f}`,style:{...h,cursor:"pointer"}},t.createElement("input",{className:`form-check-input ${p&&"rounded-circle"}`,type:"checkbox",value:c,name:l,id:i,defaultChecked:m,required:u,style:{cursor:"pointer"}}),t.createElement("label",{className:"form-check-label",htmlFor:i,style:{cursor:"pointer"}},s))),q=({permissions:o})=>{o=Object.values(o.map(e=>{const[r]=e.name.split(".");return{...e,origin:r}}).reduce((e,r)=>(e[r.origin]||(e[r.origin]=[]),e[r.origin].push(r),e),{}));const s=n.useRef(),i=n.useRef(),l=n.useRef();n.useRef();const c=n.useRef(),m=n.useRef(),u=n.useRef(),p=n.useRef(),[h,f]=n.useState(!1),[y,w]=n.useState({}),g=e=>{e!=null&&e.id?f(!0):f(!1),m.current.value=(e==null?void 0:e.id)||null,u.current.value=(e==null?void 0:e.name)||null,p.current.value=(e==null?void 0:e.description)||null,$(i.current).modal("show")},F=async e=>{c.current.disabled=!0,w(e);const r=await v.byRole(e.id);c.current.disabled=!1,$("#permissions input").prop("checked",!1),r.forEach(({name:a})=>{$(`[name="${a}"]`).prop("checked",!0)}),$(l.current).modal("show")},T=async e=>{e.preventDefault();const r={id:m.current.value||void 0,name:u.current.value,description:p.current.value};await x.save(r)&&($(s.current).dxDataGrid("instance").refresh(),$(i.current).modal("hide"))},A=async e=>{e.preventDefault();const r=[...$("#permissions input:checked")].map(E=>E.value),a={role_id:y.id,permissions:r};await v.massiveByRole(a)&&($(l.current).modal("hide"),$(s.current).dxDataGrid("instance").refresh())},N=async e=>{await x.delete(e)&&$(s.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(M,{gridRef:s,title:"Roles",rest:x,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>g()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(e,{data:r})=>{d(e,t.createElement("span",null,moment(r.created_at).format("LL")))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(e,{data:r})=>{d(e,t.createElement("span",null,moment(r.updated_at).format("LL")))}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),d(e,t.createElement(b,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>g(r)},t.createElement("i",{className:"fa fa-pen"}))),d(e,t.createElement(b,{eRef:c,className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>F(r),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>'},t.createElement("i",{className:"fas fa-th-list"}))),d(e,t.createElement(b,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>N(r.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(k,{modalRef:i,title:h?"Editar rol":"Agregar rol",onSubmit:T},t.createElement("div",{className:"row"},t.createElement("input",{ref:m,type:"hidden"}),t.createElement(B,{eRef:u,label:"Rol",col:"col-12",required:!0}),t.createElement(O,{eRef:p,label:"Descripcion",col:"col-12"}))),t.createElement(k,{modalRef:l,title:`Permisos para ${y.name}`,btnSubmitText:"Guardar",onSubmit:A,size:"sm"},t.createElement(I,{id:"permissions"},o.map((e,r)=>{const a=e[0].origin;return t.createElement(L,{key:`accordion-${r}`,id:`permission-${a}`,title:a,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row"},e.map(({id:R,name:E,description:C})=>t.createElement(_,{key:`permission-${R}`,className:"mb-0",id:`permission-ck-${R}`,label:E.replace(`${a}.`,""),name:E,value:R,title:C,style:{width:"max-content"},rounded:!0})))}))))};D((o,s)=>{S(o).render(t.createElement(P,{...s,title:"Roles"},t.createElement(q,{...s})))});
