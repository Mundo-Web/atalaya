import{C as D,c as I,R as t,r as n}from"./CreateReactScript-BhyNrTql.js";import{A as B}from"./Adminto-Dzn_iDrM.js";import{T as G,R as r,a as i,M,I as s}from"./InputFormGroup-BcHnUGlm.js";import{C as m}from"./ClientsRest-Dz_iv-eE.js";import{T as y}from"./TextareaFormGroup-DY00xL1h.js";import{P as S}from"./ProjectsRest-Cb8kv-37.js";const j=({can:c})=>{const a=n.useRef(),f=n.useRef(),d=n.useRef(),p=n.useRef(),R=n.useRef(),b=n.useRef(),E=n.useRef(),g=n.useRef(),v=n.useRef(),h=n.useRef(),C=n.useRef(),x=n.useRef(),[N,w]=n.useState(!1),A=e=>{e!=null&&e.id?w(!0):w(!1),d.current.value=(e==null?void 0:e.id)||null,p.current.value=(e==null?void 0:e.ruc)||null,R.current.value=(e==null?void 0:e.name)||null,b.current.value=(e==null?void 0:e.weburl)||null,E.current.value=(e==null?void 0:e.message)||"Cliente creado desde Atalaya",g.current.value=(e==null?void 0:e.description)||null,v.current.value=(e==null?void 0:e.contact_name)||null,h.current.value=(e==null?void 0:e.contact_phone)||null,C.current.value=(e==null?void 0:e.contact_email)||null,x.current.value=(e==null?void 0:e.contact_address)||null,$(f.current).modal("show")},T=async e=>{e.preventDefault();const l={id:d.current.value||void 0,ruc:p.current.value,name:R.current.value,web_url:b.current.value,message:E.current.value??"Cliente creado desde Atalaya",description:g.current.value??"",contact_name:v.current.value??"",contact_phone:h.current.value??"",contact_email:C.current.value??"",contact_address:x.current.value??""};await m.save(l)&&($(a.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},F=async({id:e,status:l})=>{await m.status({id:e,status:l})&&$(a.current).dxDataGrid("instance").refresh()},_=async e=>{await m.delete(e)&&$(a.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(G,{gridRef:a,title:"Clientes",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}})},filterValue:["status_id","=",12],columns:[c("projects","root","all","list")?{dataField:"id",caption:"ID",dataType:"number",cellTemplate:(e,{data:l,value:u,...o})=>{r(e,t.createElement(i,{className:"btn btn-xs btn-white",title:"Ver proyectos",onClick:()=>{o.component.collapseAll(-1),o.component.expandRow(o.row.data)}},t.createElement("i",{className:"fas fa-shapes"})))}}:null,{dataField:"ruc",caption:"RUC",sortOrder:"asc"},{dataField:"name",caption:"Razon social"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"contact_email",caption:"Correo"},{dataField:"status_id",caption:"ID estado cliente",dataType:"boolean",visible:!1},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:l})=>{switch(l.status){case 1:r(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:r(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:r(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},c("projects","root","all","list","update","changestatus","delete")?{caption:"Acciones",cellTemplate:(e,{data:l})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),c("projects","root","all","list")&&r(e,t.createElement(i,{className:"btn btn-xs btn-soft-dark",title:"Ver proyectos",onClick:()=>location.href=`/projects/?client=${l.name}`},t.createElement("i",{className:"mdi mdi-page-next"}))),c("clients","root","all","update")&&r(e,t.createElement(i,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>A(l)},t.createElement("i",{className:"fa fa-pen"}))),c("clients","root","all","changestatus")&&r(e,t.createElement(i,{className:"btn btn-xs btn-light",title:l.status===null?"Restaurar":"Cambiar estado",onClick:()=>F(l)},l.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):l.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),c("clients","root","all","delete")&&r(e,t.createElement(i,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>_(l.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}:null],masterDetail:{enabled:!1,template:async(e,{data:l,component:u})=>{e.css("padding","10px");let{data:o}=await S.paginate({filter:["client_id","=",l.id],isLoadingAll:!0});$("<div>").appendTo(e).dxDataGrid({dataSource:o,onToolbarPreparing:k=>{k.toolbarOptions.items.unshift({widget:"dxButton",location:"after",options:{icon:"fa fa-times",hint:"CERRAR TABLA",onClick:z=>{u.collapseAll(-1)}}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"client.name",caption:"Cliente"},{dataField:"type.name",caption:"Tipo"},{dataField:"name",caption:"Proyecto"},{dataField:"cost",caption:"Costo",dataType:"number"}],allowColumnResizing:!0,columnResizingMode:"widget",columnAutoWidth:!0,showBorders:!0,columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}}})}}}),t.createElement(M,{modalRef:f,title:N?"Editar cliente":"Agregar cliente",onSubmit:T,size:"md"},t.createElement("div",{className:"row"},t.createElement("input",{ref:d,type:"hidden"}),t.createElement(s,{eRef:p,label:"RUC",col:"col-4",required:!0}),t.createElement(s,{eRef:R,label:"Razon social",col:"col-8",required:!0}),t.createElement(s,{eRef:b,label:"URL Web",col:"col-12",required:!0}),t.createElement(y,{eRef:E,label:"Mensaje",col:"col-12",required:!0}),t.createElement(y,{eRef:g,label:"Descripcion",col:"col-12"}),t.createElement("div",{className:"col-12"},t.createElement("hr",{className:"my-1"})),t.createElement(s,{eRef:v,label:"Nombre de contacto",col:"col-6"}),t.createElement(s,{eRef:h,label:"Celular de contacto",col:"col-6"}),t.createElement(s,{eRef:C,label:"Email de contacto",col:"col-12",type:"email"}),t.createElement(y,{eRef:x,label:"Direccion de contacto",col:"col-12"}))))};D((c,a)=>{if(!a.can("clients","root","all","list"))return location.href="/";I(c).render(t.createElement(B,{...a,title:"Clientes"},t.createElement(j,{...a})))});
