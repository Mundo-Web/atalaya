var F=Object.defineProperty;var A=(o,s,r)=>s in o?F(o,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[s]=r;var g=(o,s,r)=>(A(o,typeof s!="symbol"?s+"":s,r),r);import{r as i,R as t,m as c,C as O,c as k}from"./CreateReactScript-CMiyu2aM.js";import{A as D}from"./Adminto-6gONrFtF.js";import{T as G,R as f,a as h}from"./TippyButton-uxdC3iXq.js";import{M as I,I as v}from"./InputFormGroup-5X8lvd6x.js";import{J as q}from"./JSEncrypt-D3I3x59l.js";const w=({col:o,label:s,eRef:r,placeholder:a,required:l=!1})=>{r||(r=i.useRef());const[m,d]=i.useState("password"),p=()=>{m=="text"?d("password"):d("text")};return t.createElement("div",{className:`form-group ${o} mb-2`},t.createElement("label",{htmlFor:""},s," ",l&&t.createElement("b",{className:"text-danger"},"*")),t.createElement("div",{className:"input-group input-group-merge"},t.createElement("input",{ref:r,type:m,className:"form-control",placeholder:a,required:l}),t.createElement("div",{className:"input-group-text","data-password":"true",onClick:p},t.createElement("i",{className:m=="text"?"mdi mdi-eye-off-outline":"mdi mdi-eye-outline"}))))};class u{}g(u,"paginate",async s=>{const{result:r}=await c.Fetch("/api/users/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)});return r}),g(u,"save",async s=>{try{const{status:r,result:a}=await c.Fetch("/api/users",{method:"POST",body:JSON.stringify(s)});if(!r)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(r){return c.Notify.add({icon:"/assets/img/logo.svg",title:"Error",body:r.message,type:"danger"}),!1}}),g(u,"status",async({id:s,status:r})=>{try{const{status:a,result:l}=await c.Fetch("/api/users/status",{method:"PATCH",body:JSON.stringify({id:s,status:r})});if(!a)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo.svg",title:"Correcto",body:l.message,type:"success"}),!0}catch(a){return c.Notify.add({icon:"/assets/img/logo.svg",title:"Error",body:a.message,type:"danger"}),!1}}),g(u,"delete",async s=>{try{const{status:r,result:a}=await c.Fetch(`/api/users/${s}`,{method:"DELETE"});if(!r)throw new Error((a==null?void 0:a.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(r){return c.Notify.add({icon:"/assets/img/logo.svg",title:"Error",body:r.message,type:"danger"}),!1}});const B=({PUBLIC_RSA_KEY:o})=>{const s=i.useRef(),r=i.useRef(),a=i.useRef(),l=i.useRef(),m=i.useRef(),d=i.useRef(),p=i.useRef(),E=i.useRef(),y=new q;y.setPublicKey(o);const[b,N]=i.useState(!1),R=e=>{e!=null&&e.id?N(!0):N(!1),a.current.value=(e==null?void 0:e.id)||null,l.current.value=(e==null?void 0:e.name)||null,m.current.value=(e==null?void 0:e.lastname)||null,d.current.value=(e==null?void 0:e.email)||null,p.current.value=null,E.current.value=null,$(r.current).modal("show")},x=async e=>{e.preventDefault();const n={id:a.current.value||void 0,name:l.current.value,lastname:m.current.value,email:d.current.value,password:y.encrypt(p.current.value)||void 0,confirm:y.encrypt(E.current.value)||void 0};await u.save(n)&&($(s.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"))},C=async({id:e,status:n})=>{await u.status({id:e,status:n})&&$(s.current).dxDataGrid("instance").refresh()},S=async e=>{await u.delete(e)&&$(s.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(G,{gridRef:s,title:"Usuarios",rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>R()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:n})=>{switch(n.status){case 1:f(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:f(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:f(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:n})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),f(e,t.createElement(h,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>R(n)},t.createElement("i",{className:"fa fa-pen"}))),f(e,t.createElement(h,{className:"btn btn-xs btn-light",title:n.status===null?"Restaurar":"Cambiar estado",onClick:()=>C(n)},n.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):n.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),f(e,t.createElement(h,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(n.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(I,{modalRef:r,title:b?"Editar usuario":"Agregar usuario",onSubmit:x},t.createElement("div",{className:"row"},t.createElement("input",{ref:a,type:"hidden"}),t.createElement(v,{eRef:l,label:"Nombres",col:"col-md-6",required:!0}),t.createElement(v,{eRef:m,label:"Apellidos",col:"col-md-6",required:!0}),t.createElement(v,{eRef:d,label:"Correo",col:"col-12",type:"email",required:!0}),t.createElement(w,{eRef:p,label:"Contraseña",col:"col-md-6",required:!b}),t.createElement(w,{eRef:E,label:"Repetir contraseña",col:"col-md-6",required:!b}))))};O((o,s)=>{k(o).render(t.createElement(D,{session:s.session,title:"Usuarios"},t.createElement(B,{...s})))});
