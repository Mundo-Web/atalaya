var C=Object.defineProperty;var P=(u,e,t)=>e in u?C(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var i=(u,e,t)=>(P(u,typeof e!="symbol"?e+"":e,t),t);import{m as a,r as d,R as s}from"./CreateReactScript-ClVaIZLH.js";import{M as N}from"./TippyButton-A6Ff804B.js";import"./Adminto-WgZqf3ZZ.js";import"./DropdownItem-BybBaEiz.js";import{A as R,a as _}from"./AccordionCard-iq8izzZ-.js";import{I as D}from"./InputFormGroup-CCmG0Ohr.js";import{T as J}from"./TextareaFormGroup-D05xY0Ci.js";import{S as j,a as x}from"./SetSelectValue-fDowhqwr.js";class m{}i(m,"paginate",async e=>{const{result:t}=await a.Fetch("/api/clients/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return t}),i(m,"save",async e=>{try{const{status:t,result:r}=await a.Fetch("/api/clients",{method:"POST",body:JSON.stringify(e)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),i(m,"status",async({id:e,status:t})=>{try{const{status:r,result:o}=await a.Fetch("/api/clients/status",{method:"PATCH",body:JSON.stringify({id:e,status:t})});if(!r)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(m,"clientStatus",async(e,t)=>{try{const{status:r,result:o}=await a.Fetch("/api/clients/client-status",{method:"PATCH",body:JSON.stringify({client:e,status:t})});if(!r)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(m,"delete",async e=>{try{const{status:t,result:r}=await a.Fetch(`/api/clients/${e}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});class l{}i(l,"paginate",async e=>{const{result:t}=await a.Fetch("/api/client-notes/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return t}),i(l,"byClient",async e=>{const{result:t}=await a.Fetch(`/api/client-notes/client/${e}`);return(t==null?void 0:t.data)??[]}),i(l,"save",async e=>{try{const{status:t,result:r}=await a.Fetch("/api/client-notes",{method:"POST",body:JSON.stringify(e)});if(!t)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),i(l,"status",async({id:e,status:t})=>{try{const{status:r,result:o}=await a.Fetch("/api/client-notes/status",{method:"PATCH",body:JSON.stringify({id:e,status:t})});if(!r)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),i(l,"delete",async e=>{try{const{status:t,result:r}=await a.Fetch(`/api/client-notes/${e}`,{method:"DELETE"});if(!t)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(t){return a.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}});const K=({can:u,client:e,setClient:t,grid2refresh:r})=>{const o=d.useRef(),g=d.useRef(),y=d.useRef(),p=d.useRef(),f=d.useRef(),h=d.useRef(),[b,E]=d.useState([]),[I,v]=d.useState(!1);d.useEffect(()=>{e.id&&S(),$(o.current).on("hidden.bs.modal",()=>{t({}),E([]),v(!1)})},[e]);const S=async()=>{const n=await l.byClient(e==null?void 0:e.id);E(n),$(o.current).modal("show")},O=async n=>{n.preventDefault();const c={id:y.current.value||void 0,type_id:p.current.value,client_id:e.id,name:f.current.value,description:h.current.value};await l.save(c)&&($(g.current).modal("hide"),y.current.value=null,x(p.current,null,null),f.current.value=null,h.current.value=null,await F(),r.refresh())},F=async()=>{const n=await l.byClient(e.id),c=n.reduce((T,A)=>Number(T)+Number(A.amount),0),w={...e,total_payments:c,remaining_amount:e.cost-c};t(w),E(n)};return s.createElement(s.Fragment,null,s.createElement(N,{modalRef:o,title:`Notas de ${(e==null?void 0:e.tradename)||(e==null?void 0:e.name)||(e==null?void 0:e.contact_name)}`,hideFooter:!0},s.createElement("div",{className:"text-center"},s.createElement("button",{className:"btn btn-primary",type:"button",onClick:()=>$(g.current).modal("show")},"Agregar nota")),b.length>0&&s.createElement("hr",{className:"my-2"}),s.createElement(R,{id:"notes-accordion"},b.sort((n,c)=>new Date(c.created_at)-new Date(n.created_at)).map((n,c)=>s.createElement(_,{key:`note-${c}`,id:`note-${c}`,title:s.createElement(s.Fragment,null,n.name,s.createElement("small",{className:"text-muted float-end"},moment(n.created_at).fromNow())),parent:"notes-accordion",isOpened:c===0},n.description)))),s.createElement(N,{modalRef:g,title:"Agregar nota",size:"sm",onSubmit:O},s.createElement("div",{id:"note-crud-container"},s.createElement("input",{ref:y,type:"hidden"}),s.createElement(j,{eRef:p,label:"Tipo de nota",col:"col-12",dropdownParent:"#note-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",filter:["table_id","=",4],required:!0}),s.createElement(D,{eRef:f,label:"Titulo de la nota",required:!0}),s.createElement(J,{eRef:h,label:"Descripcion de la nota",required:!0}))))};export{m as C,K as a};
