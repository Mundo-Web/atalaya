import{C as D,c as A,R as e,r as l}from"./CreateReactScript-ClVaIZLH.js";import{T as M,R as m,a as h,M as _}from"./TippyButton-DUEDQthR.js";import{C as g,a as G}from"./ClientNotesModal-9DVTvwtK.js";import{A as I}from"./Adminto-C8NDZ_Au.js";import{I as c}from"./InputFormGroup-CCmG0Ohr.js";import{T as q}from"./TextareaFormGroup-D05xY0Ci.js";import{D as O,S as V}from"./Dropdown-PXhDuHvv.js";import{D as j}from"./DropdownItem-CGQ01ebz.js";import"./SetSelectValue-CwDYwahQ.js";import"./DropdownEnd-wfgyKYxw.js";const U=({statuses:u,can:r})=>{const s=l.useRef(),v=l.useRef(),i=l.useRef(),d=l.useRef(),f=l.useRef(),p=l.useRef(),E=l.useRef(),b=l.useRef(),R=l.useRef(),[x,T]=l.useState(!1),[n,y]=l.useState({}),[N,w]=l.useState({}),S=t=>{T(!1),d.current.value="",f.current.value="",p.current.value="",E.current.value="",b.current.value="",R.current.value="",$(i.current).modal("show")},F=async t=>{t.preventDefault();const a={contact_name:d.current.value,contact_email:f.current.value,contact_phone:p.current.value,name:E.current.value,web_url:b.current.value,message:R.current.value,client_width:window.screen.width,client_height:window.screen.height,client_system:navigator.platform??"Linux"};await g.save(a)&&($(s.current).dxDataGrid("instance").refresh(),$(i.current).modal("hide"))},L=t=>{y(t),$(v.current).modal("show")},C=async(t,a)=>{await g.clientStatus(t,a)&&$(s.current).dxDataGrid("instance").refresh()};return e.createElement(e.Fragment,null,e.createElement(M,{gridRef:s,title:"Leads",rest:g,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),r("leads","root","all","create")&&t.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>S()}})},filterValue:["client_status.id","<>",12],columns:[{dataField:"contact_name",caption:"Cliente"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"client_status.id",caption:"ID estado cliente",visible:!1},r("leads","root","all","changestatus")?{dataField:"client_status.name",caption:"Estado del cliente",dataType:"string",cellTemplate:(t,{data:a})=>{t.attr("style","overflow: visible"),m(t,e.createElement(O,{className:"btn btn-xs btn-white rounded-pill",title:a.client_status.name,icon:{icon:"fa fa-circle",color:a.client_status.color},tippy:"Actualizar estado"},u.map(({id:o,name:k,color:B})=>e.createElement(j,{key:o,onClick:()=>C(a.id,o)},e.createElement("i",{className:"fa fa-circle",style:{color:B}})," ",k))))}}:null,{dataField:"source",caption:"Fuente",dataType:"string"},{dataField:"created_at",caption:"Fecha creacion",dataType:"datetime",cellTemplate:(t,{data:a})=>{t.text(moment(a.created_at).format("lll"))},sortOrder:"desc"},{caption:"Acciones",cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: visible"),r("leads","root","all","movetoclient")&&m(t,e.createElement(h,{className:"btn btn-xs btn-soft-success",title:"Convertir en cliente",onClick:async()=>{const{isConfirmed:o}=await V.fire({title:"Estas seguro?",text:`${a.contact_name} pasara a ser un cliente!`,icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});o&&C(a.id,12)}},e.createElement("i",{className:"fa fa-user-plus"}))),r("leads","root","all","addnotes")&&m(t,e.createElement(h,{className:"btn btn-xs btn-soft-primary position-relative",title:"Ver/Agregar notas",onClick:()=>w(a)},e.createElement("i",{className:"fas fa-sticky-note"}),a.notes>0&&e.createElement("span",{class:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"},a.notes,e.createElement("span",{class:"visually-hidden"},"Notas de ",a.name)))),m(t,e.createElement(h,{className:"btn btn-xs btn-soft-info",title:"Ver lead",onClick:()=>L(a)},e.createElement("i",{className:"fa fa-comment"})))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(_,{modalRef:v,title:`Lead de ${n==null?void 0:n.contact_name}`,onSubmit:t=>{t.preventDefault(),$(i.current).modal("hide")},hideButtonSubmit:!0},e.createElement("div",null,e.createElement("p",null,e.createElement("b",null,"Telefono"),": ",n==null?void 0:n.contact_phone),e.createElement("p",{className:"my-2"},e.createElement("b",null,"Correo"),": ",n==null?void 0:n.contact_email),e.createElement("b",null,"Mensaje"),":",e.createElement("p",{className:"mb-0"},n==null?void 0:n.message))),e.createElement(_,{modalRef:i,title:x?"Editar lead":"Nuevo lead",btnSubmitText:"Guardar",onSubmit:F},e.createElement("div",{className:"row mb-0"},e.createElement(c,{eRef:d,label:"Nombre completo",required:!0}),e.createElement(c,{eRef:f,label:"Correo electronico",col:"col-md-6",required:!0}),e.createElement(c,{eRef:p,label:"Telefono",col:"col-md-6",required:!0}),e.createElement(c,{eRef:E,label:"Empresa / Marca",col:"col-md-6"}),e.createElement(c,{eRef:b,label:"Link de WEB",col:"col-md-6"}),e.createElement(q,{eRef:R,label:"Mensaje",placeholder:"Ingresa tu mensaje",rows:4,required:!0}))),e.createElement(G,{can:r,client:N,setClient:w,grid2refresh:s,page:"leads"}))};D((u,r)=>{if(!r.can("leads","root","all","list"))return location.href="/";A(u).render(e.createElement(I,{...r,title:"Leads"},e.createElement(U,{...r})))});
