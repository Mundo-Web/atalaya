import{R as t,C as P,c as Y,r as s,m as G}from"./CreateReactScript-CMiyu2aM.js";import{i as I,R as c,T as w,M,I as u}from"./InputFormGroup-DgxbkxK5.js";import{P as m}from"./ProjectsRest-94OnTKuH.js";import{A as j}from"./Adminto-xE7bgJCa.js";import{T as q}from"./tippy-D-rnBwmO.js";import{T as B}from"./TextareaFormGroup-CkLVDc6p.js";import{S as C,a as D}from"./SetSelectValue-CLjGB2wR.js";import{m as h}from"./index-fuv_BECS.js";const O=({className:l,title:n,children:a,tippy:i})=>i?t.createElement(I,{content:i,arrow:!0},t.createElement("div",{className:"btn-group"},t.createElement("button",{className:`${l} dropdown-toggle`,"data-bs-toggle":"dropdown"},n),t.createElement("ul",{className:"dropdown-menu"},a))):t.createElement("div",{className:"btn-group"},t.createElement("button",{className:`${l} dropdown-toggle`,"data-bs-toggle":"dropdown"},n),t.createElement("ul",{className:"dropdown-menu"},a)),V=({onClick:l,children:n})=>t.createElement("li",{className:"dropdown-item"},t.createElement("a",{style:{cursor:"pointer"},onClick:l},n)),z=({statuses:l})=>{const n=s.useRef(),a=s.useRef(),i=s.useRef(),f=s.useRef(),d=s.useRef(),E=s.useRef(),b=s.useRef(),g=s.useRef(),R=s.useRef(),y=s.useRef(),v=s.useRef(),[A,x]=s.useState(!1),N=e=>{var r,o,p,T;e!=null&&e.id?x(!0):x(!1),i.current.value=(e==null?void 0:e.id)||null,D(f.current,(r=e==null?void 0:e.client)==null?void 0:r.id,(o=e==null?void 0:e.client)==null?void 0:o.name),D(d.current,(p=e==null?void 0:e.type)==null?void 0:p.id,(T=e==null?void 0:e.type)==null?void 0:T.name),E.current.value=(e==null?void 0:e.name)||null,b.current.value=(e==null?void 0:e.description)||null,g.current.value=e==null?void 0:e.cost,R.current.value=e!=null&&e.sign_at?h(e.sign_at).format("YYYY-MM-DD"):null,y.current.value=e!=null&&e.starts_at?h(e.starts_at).format("YYYY-MM-DD"):null,v.current.value=e!=null&&e.ends_at?h(e.ends_at).format("YYYY-MM-DD"):null,$(a.current).modal("show")},F=async e=>{e.preventDefault();const r={id:i.current.value||void 0,client_id:f.current.value,type_id:d.current.value,name:E.current.value,description:b.current.value,cost:g.current.value??void 0,sign_at:R.current.value??void 0,starts_at:y.current.value,ends_at:v.current.value};await m.save(r)&&($(n.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},k=async({id:e,status:r})=>{await m.status({id:e,status:r})&&$(n.current).dxDataGrid("instance").refresh()},S=async e=>{await m.delete(e)&&$(n.current).dxDataGrid("instance").refresh()},_=async(e,r)=>{await m.projectStatus(e,r)&&$(n.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(q,{gridRef:n,title:"Proyectos",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"REFRESCAR TABLA",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"NUEVO REGISTRO",onClick:()=>N()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"client.name",caption:"Cliente",filterValue:G.GET.client||void 0},{dataField:"type.name",caption:"Tipo"},{dataField:"name",caption:"Proyecto"},{dataField:"cost",caption:"Costo",dataType:"number"},{dataField:"project_status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),c(e,t.createElement(O,{className:"btn btn-xs btn-white rounded-pill",title:r.project_status.name,tippy:"Actualizar estado"},l.map(({id:o,name:p})=>t.createElement(V,{key:o,onClick:()=>_(r.id,o)},p))))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:r})=>{switch(r.status){case 1:c(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:c(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:c(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),c(e,t.createElement(w,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(r)},t.createElement("i",{className:"fa fa-pen"}))),c(e,t.createElement(w,{className:"btn btn-xs btn-light",title:r.status===null?"Restaurar":"Cambiar estado",onClick:()=>k(r)},r.status===1?t.createElement("i",{className:"fa fa-toggle-on text-success"}):r.status===0?t.createElement("i",{className:"fa fa-toggle-off text-danger"}):t.createElement("i",{className:"fas fa-trash-restore"}))),c(e,t.createElement(w,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(r.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(M,{modalRef:a,title:A?"Editar proyecto":"Agregar proyecto",onSubmit:F},t.createElement("div",{className:"row",id:"project-crud-container"},t.createElement("input",{ref:i,type:"hidden"}),t.createElement(C,{eRef:f,label:"Cliente",col:"col-12",dropdownParent:"#project-crud-container",searchAPI:"/api/clients/paginate",searchBy:"name",required:!0}),t.createElement(C,{eRef:d,label:"Tipo del proyecto",col:"col-md-4",dropdownParent:"#project-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",required:!0}),t.createElement(u,{eRef:E,label:"Nombre del proyecto",col:"col-md-8",required:!0}),t.createElement(B,{eRef:b,label:"Descripcion del proyecto",col:"col-12"}),t.createElement(u,{eRef:g,label:"Costo",col:"col-md-6",type:"number",required:!0}),t.createElement(u,{eRef:R,label:"Fecha firma",col:"col-md-6",type:"date"}),t.createElement(u,{eRef:y,label:"Fecha inicio",col:"col-md-6",type:"date",required:!0}),t.createElement(u,{eRef:v,label:"Fecha fin",col:"col-md-6",type:"date",required:!0}))))};P((l,n)=>{Y(l).render(t.createElement(j,{session:n.session,title:"Proyectos"},t.createElement(z,{...n})))});
